# Agents (Mappers) — Rust authoring quickstart

> **Audience:** LLMs writing Rust mapper plugins for Tangent.
> **Goal:** Produce deterministic, fast WASM components that transform subscribed logs into NDJSON.

## Golden rules
1. **Pure, deterministic code** – no filesystem, networking, randomness, or threads.
2. **Use the generated bindings** – access fields through the `Logview` methods; do not parse raw JSON.
3. **Emit NDJSON** – exactly one line of JSON per accepted record, encoded with `serde_json`.
4. **Narrow probes** – subscribe only to events you can process (e.g., filter on `source.name`).
5. **Fail-fast** – return a string error for unrecoverable issues; otherwise continue processing.

## Component contract
Implement the `exports::tangent::logs::mapper::Guest` trait generated by `wit-bindgen` from `.tangent/wit`:
- `metadata` → return `Meta { name, version }`.
- `probe` → return a small list of `Selector` values describing which logs you want.
- `process_logs` → transform `Logview` inputs into a `Vec<u8>` of newline-delimited JSON.

## Output model
Define a stable struct for emitted records and derive `Serialize`. Keep field names consistent with tests.

## Testing & fixtures
Use `tests/input.json` and `tests/expected.json` (NDJSON). Run `tangent plugin test --config tangent.yaml` before submitting.

## Performance tips
- Reuse buffers when possible and avoid per-record allocations.
- Prefer matching on `Scalar` variants instead of converting everything to strings.
- Keep `probe` filters tight to reduce work in `process_logs`.
